<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Enlaces Embed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 min-h-screen" x-data="embedManager()">
    <div class="container mx-auto px-4 py-8">
        <!-- Formulario y lista de enlaces (código anterior) -->
        
        <!-- Nuevo botón para generar código embed -->
        <div class="bg-white rounded-lg shadow-md p-6 mt-8">
            <h2 class="text-2xl font-semibold mb-4">Generar Código Embed</h2>
            <button 
                @click="generateEmbedCode"
                class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition duration-200"
            >
                Generar Código para Embed
            </button>
            
            <!-- Campo para mostrar el código generado -->
            <div x-show="embedCode" class="mt-4">
                <label class="block text-gray-700 mb-2">Código para insertar:</label>
                <div class="relative">
                    <textarea 
                        x-model="embedCode" 
                        class="w-full h-32 p-3 border rounded-lg bg-gray-50 font-mono text-sm"
                        readonly
                    ></textarea>
                    <button 
                        @click="copyEmbedCode"
                        class="absolute top-2 right-2 bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600"
                    >
                        Copiar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function embedManager() {
            return {
                // ... (código anterior del manager) ...
                embedCode: '',

                generateEmbedCode() {
                    if (this.embedList.length === 0) {
                        Swal.fire({
                            title: 'Error',
                            text: 'Agrega al menos un enlace antes de generar el código embed',
                            icon: 'error'
                        });
                        return;
                    }

                    // Crear un objeto con los datos necesarios
                    const embedData = {
                        links: this.embedList,
                        languages: this.languages
                    };

                    // Generar el código HTML para el embed
                    const embedHTML = `
<div class="video-embed-container" style="width:100%;max-width:800px;margin:0 auto;">
    <div class="language-switcher" style="display:flex;justify-content:center;gap:10px;margin:10px 0;">
        ${this.languages.map(lang => `
            <button onclick="switchLanguage('${lang.code}')" style="padding:5px;border-radius:4px;cursor:pointer;">
                <img src="${lang.icon}" alt="${lang.name}" style="width:40px;height:40px;">
            </button>
        `).join('')}
    </div>
    <iframe id="playerFrame" style="width:100%;height:500px;border:none;" allowfullscreen></iframe>
</div>
<script>
    // Datos de los enlaces
    const embedData = ${JSON.stringify(embedData)};
    let currentLanguage = '${this.currentLanguage}';

    function switchLanguage(lang) {
        currentLanguage = lang;
        const embed = embedData.links.find(e => e.language === lang);
        if (embed) {
            document.getElementById('playerFrame').src = embed.url;
        }
    }

    // Inicializar con el primer enlace disponible
    document.addEventListener('DOMContentLoaded', () => {
        const firstEmbed = embedData.links.find(e => e.language === currentLanguage);
        if (firstEmbed) {
            document.getElementById('playerFrame').src = firstEmbed.url;
        }
    });
<\/script>`;

                    this.embedCode = embedHTML;

                    Swal.fire({
                        title: '¡Código generado!',
                        text: 'El código embed ha sido generado exitosamente. Puedes copiarlo y pegarlo en tu sitio web.',
                        icon: 'success'
                    });
                },

                async copyEmbedCode() {
                    try {
                        await navigator.clipboard.writeText(this.embedCode);
                        Swal.fire({
                            title: '¡Copiado!',
                            text: 'Código copiado al portapapeles',
                            icon: 'success',
                            timer: 1500
                        });
                    } catch (err) {
                        Swal.fire({
                            title: 'Error',
                            text: 'No se pudo copiar el código',
                            icon: 'error'
                        });
                    }
                }
            }
        }
    </script>
</body>
</html>
