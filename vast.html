<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Enlaces Embed Mejorado</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- SweetAlert2 para alertas más atractivas -->
    <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Sortable.js para drag & drop -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    
    <!-- Alpine.js para reactividad -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Tippy.js para tooltips -->
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
</head>
<body class="bg-gray-100 min-h-screen" x-data="embedManager()">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Generador de Enlaces Embed</h1>
            <p class="text-gray-600">Gestiona tus enlaces embed con funcionalidades avanzadas</p>
        </div>

        <!-- Form -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <form @submit.prevent="addEmbed" class="space-y-4">
                <div>
                    <label class="block text-gray-700 mb-2">Enlace Embed:</label>
                    <input 
                        type="text" 
                        x-model="newEmbed.url" 
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                        placeholder="https://"
                        required
                    >
                </div>

                <div>
                    <label class="block text-gray-700 mb-2">Idioma:</label>
                    <select 
                        x-model="newEmbed.language"
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                    >
                        <template x-for="lang in languages" :key="lang.code">
                            <option :value="lang.code" x-text="lang.name"></option>
                        </template>
                    </select>
                </div>

                <button 
                    type="submit"
                    class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200"
                >
                    Agregar Enlace
                </button>
            </form>
        </div>

        <!-- Embed List -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4">Enlaces Agregados</h2>
            <div id="embedList" class="space-y-2">
                <template x-if="embedList.length === 0">
                    <div class="text-center text-gray-500 py-4">
                        No hay enlaces agregados
                    </div>
                </template>
                <template x-for="embed in embedList" :key="embed.id">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100">
                        <div class="flex items-center space-x-3">
                            <img :src="getLanguageIcon(embed.language)" class="w-8 h-8" :alt="embed.language">
                            <span x-text="embed.url" class="text-gray-700"></span>
                        </div>
                        <div class="flex space-x-2">
                            <button 
                                @click="copyToClipboard(embed.url)"
                                class="p-2 bg-green-500 text-white rounded hover:bg-green-600"
                                data-tippy-content="Copiar enlace"
                            >
                                📋
                            </button>
                            <button 
                                @click="removeEmbed(embed.id)"
                                class="p-2 bg-red-500 text-white rounded hover:bg-red-600"
                                data-tippy-content="Eliminar enlace"
                            >
                                🗑️
                            </button>
                            <!-- Nuevo botón para copiar el código embed -->
                            <button 
                                @click="copyEmbedCode(embed)"
                                class="p-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                data-tippy-content="Copiar código embed"
                            >
                                🔗
                            </button>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Preview -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-center space-x-4 mb-4">
                <template x-for="lang in languages" :key="lang.code">
                    <button 
                        @click="switchLanguage(lang.code)"
                        :class="{'ring-2 ring-blue-500': currentLanguage === lang.code}"
                        class="p-1 rounded-lg hover:bg-gray-100 transition duration-200"
                    >
                        <img :src="lang.icon" :alt="lang.name" class="w-10 h-10">
                    </button>
                </template>
            </div>
            <iframe 
                id="embedPlayer"
                x-bind:src="currentEmbedUrl"
                class="w-full h-[600px] rounded-lg"
                allowfullscreen
            ></iframe>
        </div>
    </div>

    <script>
        function embedManager() {
            return {
                embedList: [],
                currentLanguage: 'ESP',
                newEmbed: {
                    url: '',
                    language: 'ESP'
                },
                languages: [
                    { code: 'ESP', name: 'Español', icon: 'https://embed69.org/static/lang/ESP.png' },
                    { code: 'SUB', name: 'Subtitulado', icon: 'https://embed69.org/static/lang/SUB.png' },
                    { code: 'LAT', name: 'Latino', icon: 'https://embed69.org/static/lang/LAT.png' }
                ],
                
                init() {
                    // Inicializar Sortable.js
                    new Sortable(document.getElementById('embedList'), {
                        animation: 150,
                        onEnd: () => {
                            // Actualizar orden si es necesario
                        }
                    });

                    // Inicializar Tippy.js
                    tippy('[data-tippy-content]');

                    // Cargar datos guardados
                    this.loadSavedData();
                },

                get currentEmbedUrl() {
                    const embed = this.embedList.find(e => e.language === this.currentLanguage);
                    return embed ? embed.url : '';
                },

                loadSavedData() {
                    const saved = localStorage.getItem('embedList');
                    if (saved) {
                        this.embedList = JSON.parse(saved);
                    }
                },

                saveData() {
                    localStorage.setItem('embedList', JSON.stringify(this.embedList));
                },

                addEmbed() {
                    if (!this.isValidUrl(this.newEmbed.url)) {
                        Swal.fire({
                            title: 'Error',
                            text: 'Por favor, introduce una URL válida',
                            icon: 'error'
                        });
                        return;
                    }

                    this.embedList.push({
                        id: Date.now(),
                        url: this.newEmbed.url,
                        language: this.newEmbed.language
                    });

                    this.saveData();
                    this.newEmbed.url = '';

                    Swal.fire({
                        title: '¡Éxito!',
                        text: 'Enlace agregado correctamente',
                        icon: 'success',
                        timer: 1500
                    });
                },

                async copyToClipboard(text) {
                    try {
                        await navigator.clipboard.writeText(text);
                        Swal.fire({
                            title: '¡Copiado!',
                            text: 'Enlace copiado al portapapeles',
                            icon: 'success',
                            timer: 1500
                        });
                    } catch (err) {
                        Swal.fire({
                            title: 'Error',
                            text: 'No se pudo copiar el enlace',
                            icon: 'error'
                        });
                    }
                },

                removeEmbed(id) {
                    Swal.fire({
                        title: '¿Estás seguro?',
                        text: 'Esta acción no se puede deshacer',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#3085d6',
                        confirmButtonText: 'Sí, eliminar',
                        cancelButtonText: 'Cancelar'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            this.embedList = this.embedList.filter(embed => embed.id !== id);
                            this.saveData();
                            Swal.fire('Eliminado', 'El enlace ha sido eliminado', 'success');
                        }
                    });
                },

                switchLanguage(language) {
                    this.currentLanguage = language;
                    if (!this.currentEmbedUrl) {
                        Swal.fire({
                            title: 'Sin enlaces',
                            text: `No hay enlaces disponibles para ${this.getLanguageName(language)}`,
                            icon: 'info'
                        });
                    }
                },

                getLanguageIcon(code) {
                    const lang = this.languages.find(l => l.code === code);
                    return lang ? lang.icon : '';
                },

                getLanguageName(code) {
                    const lang = this.languages.find(l => l.code === code);
                    return lang ? lang.name : code;
                },

                isValidUrl(url) {
                    try {
                        new URL(url);
                        return true;
                    } catch {
                        return false;
                    }
                },

                // Función para copiar el código embed
                copyEmbedCode(embed) {
                    const embedCode = `<iframe src="${embed.url}?lang=${embed.language}" width="560" height="315" frameborder="0" allowfullscreen></iframe>`;
                    navigator.clipboard.writeText(embedCode).then(() => {
                        Swal.fire({
                            title: '¡Copiado!',
                            text: 'Código embed copiado al portapapeles',
                            icon: 'success',
                            timer: 1500
                        });
                    }).catch(() => {
                        Swal.fire({
                            title: 'Error',
                            text: 'No se pudo copiar el código embed',
                            icon: 'error'
                        });
                    });
                }
            }
        }
    </script>
</body>
</html>
